<% if (title) { %>
<h1><%= title %></h1>
<% } else {
  res.redirect('/')
} %>

<%- messages() %>

<% if (errors) { %>
  <div class="error-messages">
    <ul>
      <% errors.array().forEach(error => { %>
        <li><%= error.msg %></li>
      <% }) %>
    </ul>
  </div>
<% } %>

<div class="review-form-container">
  <div class="vehicle-info">
    <h3><%= inventory.inv_make %> <%= inventory.inv_model %> <%= inventory.inv_year %></h3>
    <img src="<%= inventory.inv_thumbnail %>" alt="<%= inventory.inv_make %> <%= inventory.inv_model %>">
  </div>
  
  <form id="addReviewForm" action="/inv/add-review" method="post">
    <fieldset>
      <legend>Write Your Review</legend>
      
      <div class="form-group">
        <label for="review_rating">Rating:</label>
        <div class="star-rating">
          <input type="radio" id="star5" name="review_rating" value="5" <%= locals.review_rating == 5 ? 'checked' : '' %>>
          <label for="star5" title="5 stars">★</label>
          <input type="radio" id="star4" name="review_rating" value="4" <%= locals.review_rating == 4 ? 'checked' : '' %>>
          <label for="star4" title="4 stars">★</label>
          <input type="radio" id="star3" name="review_rating" value="3" <%= locals.review_rating == 3 ? 'checked' : '' %>>
          <label for="star3" title="3 stars">★</label>
          <input type="radio" id="star2" name="review_rating" value="2" <%= locals.review_rating == 2 ? 'checked' : '' %>>
          <label for="star2" title="2 stars">★</label>
          <input type="radio" id="star1" name="review_rating" value="1" <%= locals.review_rating == 1 ? 'checked' : '' %>>
          <label for="star1" title="1 star">★</label>
        </div>
      </div>
      
      <div class="form-group">
        <label for="review_text">Your Review:</label>
        <textarea id="review_text" name="review_text" rows="6" required 
                  placeholder="Share your experience with this vehicle..."><%= locals.review_text || '' %></textarea>
        <div class="character-count">
          <span id="charCount">0</span>/1000 characters
        </div>
      </div>
      
      <input type="hidden" name="inv_id" value="<%= inventory.inv_id %>">
      
      <div class="form-group">
        <button type="submit" class="submit-btn">Submit Review</button>
        <a href="/inv/detail/<%= inventory.inv_id %>" class="cancel-btn">Cancel</a>
      </div>
    </fieldset>
  </form>
</div>

<script>
// Character counter
document.getElementById('review_text').addEventListener('input', function() {
  const charCount = this.value.length;
  document.getElementById('charCount').textContent = charCount;
  
  if (charCount > 1000) {
    this.style.borderColor = 'red';
  } else {
    this.style.borderColor = '';
  }
});

// Form validation
document.getElementById('addReviewForm').addEventListener('submit', function(e) {
  const rating = document.querySelector('input[name="review_rating"]:checked');
  const reviewText = document.getElementById('review_text').value.trim();
  
  if (!rating) {
    e.preventDefault();
    alert('Please select a rating.');
    return;
  }
  
  if (reviewText.length < 10) {
    e.preventDefault();
    alert('Review must be at least 10 characters long.');
    return;
  }
  
  if (reviewText.length > 1000) {
    e.preventDefault();
    alert('Review must be less than 1000 characters.');
    return;
  }
});
</script>